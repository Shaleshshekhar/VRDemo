<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Open Gift ğŸ</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <link rel="stylesheet" href="style.css" />

  <!-- Force browser to preload the GLB file -->
  <link rel="preload" as="fetch" href="https://dl.dropboxusercontent.com/scl/fi/rx30087i68e6h9ohg0c2a/Dice_world_animation_VR_Export_GLTF.glb?rlkey=ezhbftw0pj3mp0hmsv5mh0ip1&st=amcp4ucd" type="model/gltf-binary" crossorigin="anonymous">
</head>
<body>

  <!-- Splash screen -->
  <div id="splash">
    <h1>ğŸ Open Your Gift in VR</h1>
    <button id="openBtn">Open Gift</button>
  </div>
  
  <!-- Loader -->
  <div id="loader">
    <div class="loader"></div>
  </div>

  <!-- Background audio -->
  <audio id="bgMusic" loop preload="auto">
    <source src="bgmusic.mp3" type="audio/mpeg" />
  </audio>

  <model-viewer
  id="giftViewer"
  src="your.glb"
  ar
  autoplay
  camera-controls
  ar-modes="webxr scene-viewer quick-look"
  xr-environment
  shadow-intensity="1"
  environment-image="neutral"
  style="visibility:hidden;"  <!-- default hidden -->
>
  <button slot="ar-button" class="ar-button">Enter VR</button>
</model-viewer>

<script>
  const splash = document.getElementById('splash');
  const viewer = document.getElementById('giftViewer');
  const openBtn = document.getElementById('openBtn');
  const bgMusic = document.getElementById('bgMusic');
  const loader = document.getElementById('loader');

  let modelLoaded = false;

  function fallbackToModelView() {
    console.warn('âš ï¸ WebXR not available or failed. Showing model in 3D viewer.');
    loader.style.display = 'none';
    viewer.style.visibility = 'visible';
  }

  async function tryEnterVR() {
    loader.style.display = 'none';
    viewer.style.visibility = 'visible';

    try {
      console.log('ğŸ¯ Trying activateAR() for immersive mode...');
      await viewer.activateAR();
    } catch (err) {
      console.error('âŒ activateAR() failed:', err);
      fallbackToModelView();
    }
  }

  openBtn.addEventListener('click', async () => {
    console.log('ğŸ‘† User clicked Open Gift');
    
    splash.style.opacity = 0;
    setTimeout(() => splash.style.display = 'none', 1000);

    bgMusic.play().catch(err => console.warn('ğŸµ Music failed:', err));
    loader.style.display = 'flex';

    // Wait for model to load before trying VR
    if (!modelLoaded) {
      console.log('â³ Waiting for model to load...');
      return;
    }

    // Try immersive mode if possible
    if (navigator.xr && navigator.xr.isSessionSupported) {
      const supported = await navigator.xr.isSessionSupported('immersive-vr');
      console.log(`ğŸ” immersive-vr supported: ${supported}`);
      if (supported) {
        tryEnterVR();
      } else {
        fallbackToModelView();
      }
    } else {
      fallbackToModelView();
    }
  });

  viewer.addEventListener('load', () => {
    console.log('âœ… Model loaded.');
    modelLoaded = true;
  });
</script>


</body>
</html>
